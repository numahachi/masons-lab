<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Mason's Lab</title>
<style>
html, body {
    margin: 0;
    font-family: "Arial";
}

#left {
    width: 100%;
    overflow-y: auto;
    border-top: 4px solid black;
}

#right {
    background: rgb(255, 79, 79);
    color: white;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    font-size: 13px;
}

.inner {
    padding: 8px;
}

#cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(151px, max-content));
    grid-gap: 8px;
    justify-content: center;
}

.column {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.row {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 4px;
    margin: auto;
}

.row.spaced {
    justify-content: space-between;
}

#right .column > .row {
    width: min(540px, 100%);
}

.big button {
    font-size: 18px;
    height: 30px;
}

select#decklist {
    flex-grow: 1;
    height: 30px;
    font-size: 18px;
}

textarea#deck {
    box-sizing: border-box;
    margin: 4px 0 4px 0;
    width: 100%;
    height: 100%;
    font-size: 80%;
    display: none;
}

.card {
    display: inline-block;
    /*width: min(149px, calc(100% / 4 - 8px));*/
    background: linear-gradient(0deg, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 1) 60%), rgba(211, 211, 211, 1);
    /*border-radius: 0 0 5% 5%/0 0 3.644% 3.644%;*/
    border-radius: 6%/4.017%;
}

.card img {
    width: 100%;
    height: 91%;
    aspect-ratio: 745/1040;
    cursor: pointer;
}

.card .quantity {
    height: 9%;
    display: flex;
    flex-direction: row;
    margin-top: -4px;
}

.card .quantity > div {
    text-align: center;
    padding: 2px 0;
    user-select: none;
    display: flex;
    align-items: center;
}

.card .quantity .minus, .card .quantity .plus {
    width: 20%;
    flex-grow: 0.5;
    cursor: pointer;
}

.card .quantity .plus-minus-inner {
    margin: auto;
}

.card:has(.minus:active) {
    background: linear-gradient(0deg, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 1) 60%), linear-gradient(90deg, rgba(163, 163, 163, 1) 50%, rgba(211, 211, 211, 1) 50%);
}

.card:has(.plus:active) {
    background: linear-gradient(0deg, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 1) 60%), linear-gradient(-90deg, rgba(163, 163, 163, 1) 50%, rgba(211, 211, 211, 1) 50%);
}

.card .quantity .number {
    background: black;
    color: white;
    padding: 2px 10%;
}

.card .quantity .number0 {
    background: transparent;
    color: black;
}

#zoom {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    flex-direction: row;
    align-items: center;
    cursor: default;
}

#zoom-row {
    width: 100%;
    height: 80%;
}

#zoom-row .card {
    width: auto;
    height: 100%;
    aspect-ratio: 745/1142.857;
    box-shadow: 0 0 20px 10px rgba(0, 0, 0, 0.5);
}

#zoom-row .card img {
    cursor: pointer;
}

#zoom-row .card .quantity {
    font-size: 150%;
}

#zoom-previous, #zoom-next {
    flex-grow: 1;
    height: 100%;
    container-type: inline-size;
    cursor: pointer;
}

.zoom-cycle-text {
    width: 100%;
    text-align: center;
    font-size: 12cqh;
    color: white;
    text-shadow: 2px 2px 20px rgb(0, 0, 0, 0.5);
}

.zoom-cycle-text > svg {
    width: max(40px, 25%);
    display: inline-block;
}
</style>
<script>
let show_unused = true;
let current_zoom = 0;

let builtin_decks = [
    {
        "name": "Set: Nichijou",
        "value": `QTY,Name,Type,URL
0,Manabu-kun,Pokémon,images/nch/001.png
0,Takasaki-sensei,Pokémon,images/nch/002.png
0,Izumi-chan,Pokémon,images/nch/003.png
0,Sakurai-sensei,Pokémon,images/nch/004.png
0,Sasahara Koujirou,Pokémon,images/nch/005.png
0,Sasahara Kojirou,Pokémon,images/nch/006.png
0,Misato,Pokémon,images/nch/007.png
0,Tanaka-kun,Pokémon,images/nch/008.png
0,Naganon,Pokémon,images/nch/009.png
0,Naganohara Mio,Pokémon,images/nch/010.png
0,Daisuke-sensei,Pokémon,images/nch/011.png
0,Egi Masaharu,Pokémon,images/nch/012.png
0,Hakase,Pokémon,images/nch/013.png
0,Shinonome Hakase,Pokémon,images/nch/014.png
0,Nakamura-sensei,Pokémon,images/nch/015.png
0,Weboshii,Pokémon,images/nch/016.png
0,Mai-chan,Pokémon,images/nch/017.png
0,Minakami Mai,Pokémon,images/nch/018.png
0,Minakami-sensei,Pokémon,images/nch/019.png
0,Yoshino,Pokémon,images/nch/020.png
0,Double Cheeseburgirl,Pokémon,images/nch/021.png
0,Yukko,Pokémon,images/nch/022.png
0,Aioi Yuuko,Pokémon,images/nch/023.png
0,Professor Makabe,Pokémon,images/nch/024.png
0,Mihoshi,Pokémon,images/nch/025.png
0,Makoto,Pokémon,images/nch/026.png
0,Dolph,Pokémon,images/nch/027.png
0,Ogi,Pokémon,images/nch/028.png
0,Front Left Paw of the Forbidden One,Pokémon,images/nch/029.png
0,Front Right Paw of the Forbidden One,Pokémon,images/nch/030.png
0,Rear Left Paw of the Forbidden One,Pokémon,images/nch/031.png
0,Rear Right Paw of the Forbidden One,Pokémon,images/nch/032.png
0,Sakamouth The Forbidden One,Pokémon,images/nch/033.png
0,Shinonome C,Pokémon,images/nch/034.png
0,Nano-chan,Pokémon,images/nch/035.png
0,Shinonome Nano,Pokémon,images/nch/036.png
0,Biscuit #1,Pokémon,images/nch/037.png
0,Biscuit #2,Pokémon,images/nch/038.png
0,Biscuit #3,Pokémon,images/nch/039.png
0,Princess Starla,Pokémon,images/nch/040.png
0,Daiku Kenzaburou,Pokémon,images/nch/041.png
0,Sekiguchi Yuria,Pokémon,images/nch/042.png
0,Champion Sekiguchi,Pokémon,images/nch/043.png
0,Tanabo,Pokémon,images/nch/044.png
0,Sumika,Pokémon,images/nch/045.png
0,Nakanojou-kun,Pokémon,images/nch/046.png
0,Annaka-san,Pokémon,images/nch/047.png
0,Fecchan,Pokémon,images/nch/048.png
0,Pyon,Pokémon,images/nch/049.png
0,Oguri Cap,Pokémon,images/nch/050.png
0,4.5% Milk,Trainer,images/nch/051.png
0,Omurice,Trainer,images/nch/052.png
0,Snickers,Trainer,images/nch/053.png
0,Grande White Chocolate Mocha Frappuccino,Trainer,images/nch/054.png
0,Kobuddy,Trainer,images/nch/055.png
0,Buddy,Trainer,images/nch/056.png
0,Time Capsule,Trainer,images/nch/057.png
0,Kamakura,Trainer,images/nch/058.png
0,Mogura,Trainer,images/nch/059.png
0,Mega Mogura,Trainer,images/nch/060.png
0,Kumomadori,Trainer,images/nch/061.png
0,Niji,Trainer,images/nch/062.png
0,Unbearably Super-Hot Chef's Choice Chicken Bar,Trainer,images/nch/063.png
0,Computer Search,Trainer,images/nch/064.png
0,Argentine Peso,Trainer,images/nch/065.png
0,Wani,Trainer,images/nch/066.png
0,Bear Mask,Trainer,images/nch/067.png
0,Bougu,Trainer,images/nch/068.png
0,Tiny Chopping Board,Trainer,images/nch/069.png
0,Voucher of Everlasting Friendship,Trainer,images/nch/070.png
0,Technical Machine: Miracle Scarf,Trainer,images/nch/071.png
0,Technical Machine:  Wood Cubes,Trainer,images/nch/072.png
0,Hakase's Research,Trainer,images/nch/073.png
0,Imposter Hakase's Research,Trainer,images/nch/074.png
0,Kouchou,Trainer,images/nch/075.png
0,Kyoutou,Trainer,images/nch/076.png
0,Policeman,Trainer,images/nch/077.png
0,Hirose,Trainer,images/nch/078.png
0,Arama-san,Trainer,images/nch/079.png
0,Gentleman,Trainer,images/nch/080.png
0,Oogo,Trainer,images/nch/081.png
0,Tomioka-sensei,Trainer,images/nch/082.png
0,Akagi-sensei,Trainer,images/nch/083.png
0,Pino,Trainer,images/nch/084.png
0,Mono-eye,Trainer,images/nch/085.png
0,Cupid's Failure,Trainer,images/nch/086.png
0,Amagawa Shinbun,Trainer,images/nch/087.png
0,Tamamura,Trainer,images/nch/088.png
0,Taishou's Orders,Trainer,images/nch/089.png
0,Bera-chan,Trainer,images/nch/090.png
0,Yanba-kun's Disruption,Trainer,images/nch/091.png
0,Rokugou,Trainer,images/nch/092.png
0,Daifuku-kun,Trainer,images/nch/093.png
0,Shihandai's Encouragement,Trainer,images/nch/094.png
0,Oomama Midori,Trainer,images/nch/095.png
0,Sasahara's Farm,Trainer,images/nch/096.png
0,Tokisadame Shoutengai,Trainer,images/nch/097.png
0,Tokisadame High School,Trainer,images/nch/098.png
0,Igo Soccer Club,Trainer,images/nch/099.png
0,Embankment of Youth,Trainer,images/nch/100.png
0,Basic Grass Energy,Energy,https://images.pokemontcg.io/sve/1_hires.png
0,Basic Fire Energy,Energy,https://images.pokemontcg.io/sve/2_hires.png
0,Basic Water Energy,Energy,https://images.pokemontcg.io/sve/3_hires.png
0,Basic Lightning Energy,Energy,https://images.pokemontcg.io/sve/4_hires.png
0,Basic Psychic Energy,Energy,https://images.pokemontcg.io/sve/5_hires.png
0,Basic Fighting Energy,Energy,https://images.pokemontcg.io/sve/6_hires.png
0,Basic Darkness Energy,Energy,https://images.pokemontcg.io/sve/7_hires.png
0,Basic Metal Energy,Energy,https://images.pokemontcg.io/sve/8_hires.png
`,
    },
];

let urls = [
    {
        // Manabu-kun
        "display": "images/nch/001.png",
        "external": [
            "https://files.catbox.moe/srhr50.png",
        ],
    },
    {
        // Takasaki-sensei
        "display": "images/nch/002.png",
        "external": [
            "https://files.catbox.moe/dxaq84.png",
        ],
    },
    {
        // Izumi-chan
        "display": "images/nch/003.png",
        "external": [
            "https://files.catbox.moe/zo6eir.png",
        ],
    },
    {
        // Sakurai-sensei
        "display": "images/nch/004.png",
        "external": [
            "https://files.catbox.moe/kcauvw.png",
        ],
    },
    {
        // Sasahara Koujirou
        "display": "images/nch/005.png",
        "external": [
            "https://files.catbox.moe/xa1du0.png",
        ],
    },
    {
        // Sasahara Kojirou
        "display": "images/nch/006.png",
        "external": [
            "https://files.catbox.moe/ye9t40.png",
        ],
    },
    {
        // Misato
        "display": "images/nch/007.png",
        "external": [
            "https://files.catbox.moe/8o1o8e.png",
        ],
    },
    {
        // Tanaka-kun
        "display": "images/nch/008.png",
        "external": [
            "https://files.catbox.moe/mlyyp2.png",
        ],
    },
    {
        // Naganon
        "display": "images/nch/009.png",
        "external": [
            "https://files.catbox.moe/bi2ufo.png",
        ],
    },
    {
        // Naganohara Mio
        "display": "images/nch/010.png",
        "external": [
            "https://files.catbox.moe/kwhhfh.png",
        ],
    },
    {
        // Daisuke-sensei
        "display": "images/nch/011.png",
        "external": [
            "https://files.catbox.moe/l519vc.png",
        ],
    },
    {
        // Egi Masaharu
        "display": "images/nch/012.png",
        "external": [
            "https://files.catbox.moe/gz7o1v.png",
        ],
    },
    {
        // Hakase
        "display": "images/nch/013.png",
        "external": [
            "https://files.catbox.moe/9crbis.png",
        ],
    },
    {
        // Shinonome Hakase
        "display": "images/nch/014.png",
        "external": [
            "https://files.catbox.moe/se59qb.png",
        ],
    },
    {
        // Nakamura-sensei
        "display": "images/nch/015.png",
        "external": [
            "https://files.catbox.moe/auau19.png",
        ],
    },
    {
        // Weboshii
        "display": "images/nch/016.png",
        "external": [
            "https://files.catbox.moe/sx1m3j.png",
        ],
    },
    {
        // Mai-chan
        "display": "images/nch/017.png",
        "external": [
            "https://files.catbox.moe/r7c9m4.png",
        ],
    },
    {
        // Minakami Mai
        "display": "images/nch/018.png",
        "external": [
            "https://files.catbox.moe/03cj56.png",
        ],
    },
    {
        // Minakami-sensei
        "display": "images/nch/019.png",
        "external": [
            "https://files.catbox.moe/93gmhk.png",
        ],
    },
    {
        // Yoshino
        "display": "images/nch/020.png",
        "external": [
            "https://files.catbox.moe/hi0pjb.png",
        ],
    },
    {
        // Double Cheeseburgirl
        "display": "images/nch/021.png",
        "external": [
            "https://files.catbox.moe/zd93vm.png",
        ],
    },
    {
        // Yukko
        "display": "images/nch/022.png",
        "external": [
            "https://files.catbox.moe/9t295l.png",
        ],
    },
    {
        // Aioi Yuuko
        "display": "images/nch/023.png",
        "external": [
            "https://files.catbox.moe/yielmv.png",
        ],
    },
    {
        // Professor Makabe
        "display": "images/nch/024.png",
        "external": [
            "https://files.catbox.moe/04o8yd.png",
        ],
    },
    {
        // Mihoshi
        "display": "images/nch/025.png",
        "external": [
            "https://files.catbox.moe/czk8sz.png",
        ],
    },
    {
        // Makoto
        "display": "images/nch/026.png",
        "external": [
            "https://files.catbox.moe/g6im6d.png",
        ],
    },
    {
        // Dolph
        "display": "images/nch/027.png",
        "external": [
            "https://files.catbox.moe/2blw24.png",
        ],
    },
    {
        // Ogi
        "display": "images/nch/028.png",
        "external": [
            "https://files.catbox.moe/s7oja0.png",
        ],
    },
    {
        // Front Left Paw of the Forbidden One
        "display": "images/nch/029.png",
        "external": [
            "https://files.catbox.moe/661je1.png",
        ],
    },
    {
        // Front Right Paw of the Forbidden One
        "display": "images/nch/030.png",
        "external": [
            "https://files.catbox.moe/oo89sg.png",
        ],
    },
    {
        // Rear Left Paw of the Forbidden One
        "display": "images/nch/031.png",
        "external": [
            "https://files.catbox.moe/5hpgn7.png",
        ],
    },
    {
        // Rear Right Paw of the Forbidden One
        "display": "images/nch/032.png",
        "external": [
            "https://files.catbox.moe/pz54oy.png",
        ],
    },
    {
        // Sakamouth The Forbidden One
        "display": "images/nch/033.png",
        "external": [
            "https://files.catbox.moe/jptk6d.png",
        ],
    },
    {
        // Shinonome C
        "display": "images/nch/034.png",
        "external": [
            "https://files.catbox.moe/nvw75v.png",
        ],
    },
    {
        // Nano-chan
        "display": "images/nch/035.png",
        "external": [
            "https://files.catbox.moe/3dzb7e.png",
        ],
    },
    {
        // Shinonome Nano
        "display": "images/nch/036.png",
        "external": [
            "https://files.catbox.moe/3iwjgx.png",
        ],
    },
    {
        // Biscuit #1
        "display": "images/nch/037.png",
        "external": [
            "https://files.catbox.moe/ywf15z.png",
        ],
    },
    {
        // Biscuit #2
        "display": "images/nch/038.png",
        "external": [
            "https://files.catbox.moe/kr0d8n.png",
        ],
    },
    {
        // Biscuit #3
        "display": "images/nch/039.png",
        "external": [
            "https://files.catbox.moe/52t5vg.png",
        ],
    },
    {
        // Princess Starla
        "display": "images/nch/040.png",
        "external": [
            "https://files.catbox.moe/abvfu3.png",
        ],
    },
    {
        // Daiku Kenzaburou
        "display": "images/nch/041.png",
        "external": [
            "https://files.catbox.moe/no1vrw.png",
        ],
    },
    {
        // Sekiguchi Yuria
        "display": "images/nch/042.png",
        "external": [
            "https://files.catbox.moe/4rbqr9.png",
        ],
    },
    {
        // Champion Sekiguchi
        "display": "images/nch/043.png",
        "external": [
            "https://files.catbox.moe/r843j8.png",
        ],
    },
    {
        // Tanabo
        "display": "images/nch/044.png",
        "external": [
            "https://files.catbox.moe/ca2tnn.png",
        ],
    },
    {
        // Sumika
        "display": "images/nch/045.png",
        "external": [
            "https://files.catbox.moe/lckyik.png",
        ],
    },
    {
        // Nakanojou-kun
        "display": "images/nch/046.png",
        "external": [
            "https://files.catbox.moe/2x247b.png",
        ],
    },
    {
        // Annaka-san
        "display": "images/nch/047.png",
        "external": [
            "https://files.catbox.moe/588b4o.png",
        ],
    },
    {
        // Fecchan
        "display": "images/nch/048.png",
        "external": [
            "https://files.catbox.moe/8afnxg.png",
        ],
    },
    {
        // Pyon
        "display": "images/nch/049.png",
        "external": [
            "https://files.catbox.moe/y49p92.png",
        ],
    },
    {
        // Oguri Cap
        "display": "images/nch/050.png",
        "external": [
            "https://files.catbox.moe/nf96aq.png",
        ],
    },
    {
        // 4.5% Milk
        "display": "images/nch/051.png",
        "external": [
            "https://files.catbox.moe/ubbch5.png",
        ],
    },
    {
        // Omurice
        "display": "images/nch/052.png",
        "external": [
            "https://files.catbox.moe/sq9ei7.png",
        ],
    },
    {
        // Snickers
        "display": "images/nch/053.png",
        "external": [
            "https://files.catbox.moe/hr0e8v.png",
        ],
    },
    {
        // Grande White Chocolate Mocha Frappuccino
        "display": "images/nch/054.png",
        "external": [
            "https://files.catbox.moe/ofoxsb.png",
        ],
    },
    {
        // Kobuddy
        "display": "images/nch/055.png",
        "external": [
            "https://files.catbox.moe/4vyz0m.png",
        ],
    },
    {
        // Buddy
        "display": "images/nch/056.png",
        "external": [
            "https://files.catbox.moe/pmr15w.png",
        ],
    },
    {
        // Time Capsule
        "display": "images/nch/057.png",
        "external": [
            "https://files.catbox.moe/mbahrl.png",
        ],
    },
    {
        // Kamakura
        "display": "images/nch/058.png",
        "external": [
            "https://files.catbox.moe/fs8hrb.png",
        ],
    },
    {
        // Mogura
        "display": "images/nch/059.png",
        "external": [
            "https://files.catbox.moe/a63kso.png",
        ],
    },
    {
        // Mega Mogura
        "display": "images/nch/060.png",
        "external": [
            "https://files.catbox.moe/932nw7.png",
        ],
    },
    {
        // Kumomadori
        "display": "images/nch/061.png",
        "external": [
            "https://files.catbox.moe/v243za.png",
        ],
    },
    {
        // Niji
        "display": "images/nch/062.png",
        "external": [
            "https://files.catbox.moe/fu0nys.png",
        ],
    },
    {
        // Unbearably Super-Hot Chef's Choice Chicken Bar
        "display": "images/nch/063.png",
        "external": [
            "https://files.catbox.moe/t7md49.png",
        ],
    },
    {
        // Computer Search
        "display": "images/nch/064.png",
        "external": [
            "https://files.catbox.moe/uug4r4.png",
        ],
    },
    {
        // Argentine Peso
        "display": "images/nch/065.png",
        "external": [
            "https://files.catbox.moe/6alu81.png",
        ],
    },
    {
        // Wani
        "display": "images/nch/066.png",
        "external": [
            "https://files.catbox.moe/3aybma.png",
        ],
    },
    {
        // Bear Mask
        "display": "images/nch/067.png",
        "external": [
            "https://files.catbox.moe/7ndjyz.png",
        ],
    },
    {
        // Bougu
        "display": "images/nch/068.png",
        "external": [
            "https://files.catbox.moe/e74wr4.png",
        ],
    },
    {
        // Tiny Chopping Board
        "display": "images/nch/069.png",
        "external": [
            "https://files.catbox.moe/60f4ba.png",
        ],
    },
    {
        // Voucher of Everlasting Friendship
        "display": "images/nch/070.png",
        "external": [
            "https://files.catbox.moe/gijzhv.png",
        ],
    },
    {
        // Technical Machine: Miracle Scarf
        "display": "images/nch/071.png",
        "external": [
            "https://files.catbox.moe/4eav01.png",
        ],
    },
    {
        // Technical Machine:  Wood Cubes
        "display": "images/nch/072.png",
        "external": [
            "https://files.catbox.moe/xjwyvi.png",
        ],
    },
    {
        // Hakase's Research
        "display": "images/nch/073.png",
        "external": [
            "https://files.catbox.moe/x7qswu.png",
        ],
    },
    {
        // Imposter Hakase's Research
        "display": "images/nch/074.png",
        "external": [
            "https://files.catbox.moe/ii9ea2.png",
        ],
    },
    {
        // Kouchou
        "display": "images/nch/075.png",
        "external": [
            "https://files.catbox.moe/w5s4mz.png",
        ],
    },
    {
        // Kyoutou
        "display": "images/nch/076.png",
        "external": [
            "https://files.catbox.moe/esxhld.png",
        ],
    },
    {
        // Policeman
        "display": "images/nch/077.png",
        "external": [
            "https://files.catbox.moe/gft445.png",
        ],
    },
    {
        // Hirose
        "display": "images/nch/078.png",
        "external": [
            "https://files.catbox.moe/dvh9u5.png",
        ],
    },
    {
        // Arama-san
        "display": "images/nch/079.png",
        "external": [
            "https://files.catbox.moe/m2z0yt.png",
        ],
    },
    {
        // Gentleman
        "display": "images/nch/080.png",
        "external": [
            "https://files.catbox.moe/g3dmbe.png",
        ],
    },
    {
        // Oogo
        "display": "images/nch/081.png",
        "external": [
            "https://files.catbox.moe/ubr1yk.png",
        ],
    },
    {
        // Tomioka-sensei
        "display": "images/nch/082.png",
        "external": [
            "https://files.catbox.moe/ef1yzq.png",
        ],
    },
    {
        // Akagi-sensei
        "display": "images/nch/083.png",
        "external": [
            "https://files.catbox.moe/oi2hp2.png",
        ],
    },
    {
        // Pino
        "display": "images/nch/084.png",
        "external": [
            "https://files.catbox.moe/bfoq2q.png",
        ],
    },
    {
        // Mono-eye
        "display": "images/nch/085.png",
        "external": [
            "https://files.catbox.moe/2rugd5.png",
        ],
    },
    {
        // Cupid's Failure
        "display": "images/nch/086.png",
        "external": [
            "https://files.catbox.moe/gef46n.png",
        ],
    },
    {
        // Amagawa Shinbun
        "display": "images/nch/087.png",
        "external": [
            "https://files.catbox.moe/rflgao.png",
        ],
    },
    {
        // Tamamura
        "display": "images/nch/088.png",
        "external": [
            "https://files.catbox.moe/xwz7ma.png",
        ],
    },
    {
        // Taishou's Orders
        "display": "images/nch/089.png",
        "external": [
            "https://files.catbox.moe/k71daa.png",
        ],
    },
    {
        // Bera-chan
        "display": "images/nch/090.png",
        "external": [
            "https://files.catbox.moe/n798fy.png",
        ],
    },
    {
        // Yanba-kun's Disruption
        "display": "images/nch/091.png",
        "external": [
            "https://files.catbox.moe/vlazkx.png",
        ],
    },
    {
        // Rokugou
        "display": "images/nch/092.png",
        "external": [
            "https://files.catbox.moe/fnfx2i.png",
        ],
    },
    {
        // Daifuku-kun
        "display": "images/nch/093.png",
        "external": [
            "https://files.catbox.moe/kbe5uh.png",
        ],
    },
    {
        // Shihandai's Encouragement
        "display": "images/nch/094.png",
        "external": [
            "https://files.catbox.moe/kw4cec.png",
        ],
    },
    {
        // Oomama Midori
        "display": "images/nch/095.png",
        "external": [
            "https://files.catbox.moe/dajx29.png",
        ],
    },
    {
        // Sasahara's Farm
        "display": "images/nch/096.png",
        "external": [
            "https://files.catbox.moe/74lj1k.png",
        ],
    },
    {
        // Tokisadame Shoutengai
        "display": "images/nch/097.png",
        "external": [
            "https://files.catbox.moe/ubtboj.png",
        ],
    },
    {
        // Tokisadame High School
        "display": "images/nch/098.png",
        "external": [
            "https://files.catbox.moe/r3zn06.png",
        ],
    },
    {
        // Igo Soccer Club
        "display": "images/nch/099.png",
        "external": [
            "https://files.catbox.moe/m5y9p0.png",
        ],
    },
    {
        // Embankment of Youth
        "display": "images/nch/100.png",
        "external": [
            "https://files.catbox.moe/p766wb.png",
        ],
    },
    {
        // ;)
        "display": "images/nch/101.png",
        "external": [
            "https://files.catbox.moe/6znjhp.png",
        ],
    },
];

let url_lookup = {};

let storage_keys = () => {
    let keys = [];
    for (let i = 0; i < window.localStorage.length; i++) {
        let key = window.localStorage.key(i);
        if (!key.startsWith("masons-lab:")) {
            continue;
        }
        keys.push(key.substr("masons-lab:".length));
    }
    return keys;
}

let storage_get = (key) => {
    return window.localStorage.getItem(`masons-lab:${key}`);
}

let storage_set = (key, value) => {
    return window.localStorage.setItem(`masons-lab:${key}`, value);
}

let storage_remove = (key) => {
    return window.localStorage.removeItem(`masons-lab:${key}`);
}

let init_decklist = () => {
    let decklist = document.getElementById("decklist");
    decklist.innerHTML = "";

    let current_deck = storage_get("__current_deck");

    let names = [];
    for (let key of storage_keys()) {
        if (key.startsWith("__")) {
            continue;
        }
        names.push(key);
    }
    names.sort((a, b) => a.localeCompare(b, "en", {"sensitivity": "base"}));
    for (let name of names) {
        let option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        decklist.appendChild(option);
        if (current_deck === name) {
            decklist.value = name;
            document.getElementById("deck").value = storage_get(name);
        }
    }

    for (let deck of builtin_decks) {
        let option = document.createElement("option");
        option.value = deck.name;
        option.textContent = deck.name;
        decklist.appendChild(option);
        if (current_deck === deck.name || current_deck === null) {
            decklist.value = deck.name;
            document.getElementById("deck").value = deck.value;
        }
    }
}

let load = async () => {
    let show_unused_storage = storage_get("__show_unused");
    if (show_unused_storage !== null) {
        show_unused = show_unused_storage === "true";
        document.getElementById("toggle-unused").textContent = show_unused ? "Hide" : "Show";
    }

    url_lookup = {};
    for (let entry of urls) {
        url_lookup[entry.display] = entry;
        for (let external of entry.external) {
            url_lookup[external] = entry;
        }
    }

    init_decklist();

    let params = new URLSearchParams(document.location.search);
    let importable = params.get("import");
    if (importable !== null && importable.length > 0) {
        try {
            let decoded = await decompress(decodeURIComponent(importable));
            let name = decoded.slice(0, decoded.indexOf("\n"));
            if (confirm(`Import deck "${name}"?`)) {
                let text = decoded.slice(decoded.indexOf("\n") + 1);
                import_deck(name, text);
            }
            window.history.replaceState(null, "", window.location.pathname);
        } catch (e) {
            console.error(e);
        }
    }
}

let save = (deckname) => {
    storage_set(deckname, document.getElementById("deck").value);
    storage_set("__current_deck", deckname);
}

let remove_deck = () => {
    let deckname = document.getElementById("decklist").value;
    if (!deckname.startsWith("Custom: ")) {
        return;
    }
    storage_remove(deckname);
    if (storage_get("__current_deck") === deckname) {
        storage_remove("__current_deck");
    }
    init_decklist();
    update();
}

let delete_deck = () => {
    let deckname = document.getElementById("decklist").value;
    if (!deckname.startsWith("Custom: ")) {
        return;
    }
    if (window.confirm(`Delete "${deckname}"?`)) {
        remove_deck();
    }
}

let get_unique_deckname = (deckname) => {
    while (storage_get(deckname) !== null) {
        let parts = deckname.split(" ");
        if (parts.length > 0) {
            let last = parts[parts.length - 1];
            let n = Number(last);
            if (last !== "" && !isNaN(n)) {
                parts[parts.length - 1] = `${n + 1}`;
                deckname = parts.join(" ");
                continue;
            }
        }
        deckname += " 2";
    }
    return deckname;
}

let clone = () => {
    let deckname = document.getElementById("decklist").value;
    if (deckname.indexOf(": ") !== -1) {
        deckname = deckname.substr(deckname.indexOf(": ") + 2);
    } else {
        deckname = "Untitled";
    }
    deckname = `Custom: ${deckname}`;
    deckname = get_unique_deckname(deckname);
    save(deckname);
    init_decklist();
}

let rename = () => {
    let deckname = document.getElementById("decklist").value;
    let was_custom = deckname.startsWith("Custom: ");
    if (deckname.indexOf(": ") !== -1) {
        deckname = deckname.substr(deckname.indexOf(": ") + 2);
    }
    deckname = window.prompt("Enter a new name for this deck:", deckname);
    if (!deckname) {
        return;
    }
    if (!was_custom) {
        clone();
    }
    deckname = `Custom: ${deckname}`;
    if (deckname === document.getElementById("decklist").value) {
        return;
    }
    deckname = get_unique_deckname(deckname);
    save(deckname);
    remove_deck();
}

let write = (lines) => {
    document.getElementById("deck").value = lines;
    let deckname = document.getElementById("decklist").value;
    if (deckname.startsWith("Custom: ")) {
        save(deckname);
    } else {
        clone();
    }
}

let switch_deck = () => {
    let deckname = document.getElementById("decklist").value;
    storage_set("__current_deck", deckname);
    init_decklist();
    update();
}

let get_card = (i) => {
    return Array.from(document.getElementsByClassName("card")).filter((c) => c.getAttribute("data-i") === `${i}`);
}

let init_card = (card, i, qty, url) => {
    card.classList.add("card");
    card.setAttribute("data-i", i);
    card.innerHTML = "";

    let img = document.createElement("img");
    let url_entry = url_lookup[url];
    if (url_entry) {
        img.src = url_entry.display;
    } else {
        img.src = url;
    }
    img.addEventListener("click", (e) => {
        if (document.getElementById("cards").contains(e.srcElement)) {
            zoom(i);
        }
    });
    card.appendChild(img);

    let quantity = document.createElement("div");
    quantity.classList.add("quantity");
    card.appendChild(quantity);

    let minus = document.createElement("div");
    minus.classList.add("minus");
    minus.addEventListener("click", (e) => {
        e.stopPropagation();
        add_quantity(i, -1);
    });
    quantity.appendChild(minus);

    let minus_inner = document.createElement("div");
    minus_inner.classList.add("plus-minus-inner");
    minus_inner.textContent = "–";
    minus.appendChild(minus_inner);

    let number = document.createElement("div");
    update_number(card, number, qty);
    quantity.appendChild(number);

    let plus = document.createElement("div");
    plus.classList.add("plus");
    plus.addEventListener("click", (e) => {
        e.stopPropagation();
        add_quantity(i, 1);
    });
    quantity.appendChild(plus);

    let plus_inner = document.createElement("div");
    plus_inner.classList.add("plus-minus-inner");
    plus_inner.textContent = "+";
    plus.appendChild(plus_inner);
};

let update_number = (card, number, qty) => {
    number.className = "";
    number.classList.add("number");
    number.textContent = qty;
    if (qty === 0) {
        number.classList.add("number0");
    }
    card.style.display = (qty === 0 && !show_unused && document.getElementById("cards").contains(card)) ? "none" : "inline-block";
};

let add_quantity = (i, offset) => {
    let lines = [];
    let j = 0;
    for (let line of document.getElementById("deck").value.split("\n")) {
        j += 1;
        if (i === j) {
            let [old_qty, name, type, url, ...rest] = line.split(",");
            let qty = Number(old_qty) + offset;
            if (qty < 0) {
                qty = 0;
            }
            let new_line = [qty, name, type, url].join(",");
            lines.push(new_line);
            for (let card of get_card(i)) {
                let number = card.getElementsByClassName("number")[0];
                update_number(card, number, qty);
            }
        } else {
            lines.push(line);
        }
    }
    write(lines.join("\n"));
    update_stats();
};

let parse_lines = () => {
    let lines = [];
    let i = 0;
    for (let line of document.getElementById("deck").value.split("\n")) {
        i += 1;
        let [qty_str, name, type, url, ...rest] = line.split(",");
        if (rest.length > 0) {
            continue;
        }
        let qty = Number(qty_str);
        if (isNaN(qty) || !qty_str) {
            continue;
        }
        lines.push([i, qty, name, type, url]);
    }
    return lines;
};

let update_stats = () => {
    let pokemon = 0;
    let trainers = 0;
    let energies = 0;
    let unused = 0;
    for (let [i, qty, name, type, url] of parse_lines()) {
        if (qty === 0) {
            unused += 1;
        } else if (type === "Pokémon") {
            pokemon += qty;
        } else if (type === "Trainer") {
            trainers += qty;
        } else if (type === "Energy") {
            energies += qty;
        }
    }
    document.getElementById("stats").textContent = `${pokemon + trainers + energies} cards = ${pokemon} Pokémon + ${trainers} Trainers + ${energies} Energies`;
    document.getElementById("stats-unused").textContent = `${unused} unused:`;
};

let update = () => {
    let cards = document.getElementById("cards");
    cards.innerHTML = "";

    for (let [i, qty, name, type, url] of parse_lines()) {
        let card = document.createElement("span");
        cards.appendChild(card);
        init_card(card, i, qty, url);
    }

    update_stats();
}

let toggle_unused = () => {
    let button = document.getElementById("toggle-unused");
    if (button.textContent === "Hide") {
        show_unused = false;
        button.textContent = "Show";
    } else {
        show_unused = true;
        button.textContent = "Hide";
    }
    storage_set("__show_unused", show_unused);
    update();
};

let remove_unused = () => {
    let lines = [];
    let unused = 0;
    for (let line of document.getElementById("deck").value.split("\n")) {
        let [qty, name, type, url, ...rest] = line.split(",");
        if (qty === "0") {
            unused += 1;
            continue;
        }
        lines.push(line);
    }
    let deckname = document.getElementById("decklist").value;
    if (window.confirm(`Remove ${unused} unused cards from "${deckname}"?`)) {
        write(lines.join("\n"));
        update();
    }
};

let play = () => {
    window.open("https://ptcgsim.online/");
};

let export_deck = () => {
    let lines = [];
    for (let line of document.getElementById("deck").value.split("\n")) {
        let [qty, name, type, url, ...rest] = line.split(",");
        let url_entry = url_lookup[url];
        if (url_entry) {
            line = [qty, name, type, url_entry.external.at(-1), ...rest].join(",");
        }
        lines.push(line);
    }
    return lines.join("\n");
};

let download = () => {
    let deckname = document.getElementById("decklist").value;
    if (deckname.indexOf(": ") !== -1) {
        deckname = deckname.substr(deckname.indexOf(": ") + 2);
    }
    let e = document.createElement("a");
    e.setAttribute("href", `data:text/plain;charset=utf-8,${encodeURIComponent(export_deck())}`);
    e.setAttribute("download", `${deckname}.csv`);
    e.style.display = "none";
    document.body.appendChild(e);
    e.click();
    document.body.removeChild(e);
};

let upload = () => {
    document.getElementById("upload_impl").click();
};

let process_upload = (text) => {
    let lines = [`QTY,Name,Type,URL`];
    for (let line of text.split("\n")) {
        let [qty_str, name, type, url, ...rest] = line.split(",");
        if (rest.length > 0) {
            continue;
        }
        let qty = Number(qty_str);
        if (isNaN(qty) || !qty_str) {
            continue;
        }
        let url_entry = url_lookup[url];
        if (url_entry) {
            url = url_entry.display;
        }
        lines.push(`${qty},${name},${type},${url}`);
    }
    return lines.join(`\n`);
};

let upload_impl = async (e) => {
    for (let file of e.target.files) {
        let deckname = file.name;
        if (deckname.endsWith(".csv")) {
            deckname = deckname.slice(0, -4);
        }
        deckname = `Custom: ${deckname}`;
        deckname = get_unique_deckname(deckname);
        let text = await file.text();
        text = process_upload(text);
        document.getElementById("deck").value = text;
        save(deckname);
    }
    e.target.value = null;
    init_decklist();
    update();
};

let import_deck = (name, text) => {
    let deckname = `Custom: ${name}`;
    deckname = get_unique_deckname(deckname);
    document.getElementById("deck").value = text;
    save(deckname);
    init_decklist();
    update();
};

let copy = () => {
    navigator.clipboard.writeText(export_deck());
};

let paste = async () => {
    import_deck(`Untitled`, await navigator.clipboard.readText());
};

let compress = (string) => {
    const blobToBase64 = blob => new Promise((resolve, _) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(',')[1]);
        reader.readAsDataURL(blob);
    });
    const byteArray = new TextEncoder().encode(string);
    const cs = new CompressionStream('gzip');
    const writer = cs.writable.getWriter();
    writer.write(byteArray);
    writer.close();
    return new Response(cs.readable).blob().then(blobToBase64);
};

let decompress = (base64string) => {
    const bytes = Uint8Array.from(atob(base64string), c => c.charCodeAt(0));
    const cs = new DecompressionStream('gzip');
    const writer = cs.writable.getWriter();
    writer.write(bytes);
    writer.close();
    return new Response(cs.readable).arrayBuffer().then(function (arrayBuffer) {
        return new TextDecoder().decode(arrayBuffer);
    });
}

let copy_link = async () => {
    let deckname = document.getElementById("decklist").value;
    if (deckname.indexOf(": ") !== -1) {
        deckname = deckname.substr(deckname.indexOf(": ") + 2);
    }
    let q = encodeURIComponent(await compress(`${deckname}\n${export_deck()}`));
    navigator.clipboard.writeText(`${window.location.origin}${window.location.pathname}?import=${q}`);
};

let zoom = (i) => {
    let lines = parse_lines();
    if (lines.length === 0 || i < lines[0][0] || i > lines[lines.length - 1][0]) {
        return;
    }
    current_zoom = i;
    let zoom = document.getElementById("zoom");
    let zoom_card = document.createElement("span");
    for (let [j, qty, name, type, url] of lines) {
        if (i === j) {
            init_card(zoom_card, i, qty, url);
            zoom.getElementsByClassName("card")[0].replaceWith(zoom_card);
            document.querySelector(`#zoom-previous .zoom-cycle-text`).style.display = (i === lines[0][0]) ? "none" : "block";
            document.querySelector(`#zoom-next .zoom-cycle-text`).style.display = (i === lines[lines.length - 1][0]) ? "none" : "block";
            zoom.style.display = "flex";
            return;
        }
    }
}

let zoom_previous = (e) => {
    e.stopPropagation();
    let lines = parse_lines();
    lines.reverse();
    for (let [i, qty, name, type, url] of lines) {
        if (i >= current_zoom) {
            continue;
        }
        let card = document.querySelector(`#cards [data-i='${i}']`);
        if (card === null) {
            continue;
        }
        if (card.style.display === "none") {
            continue;
        }
        zoom(i);
        return;
    }
}

let zoom_next = (e) => {
    e.stopPropagation();
    let lines = parse_lines();
    for (let [i, qty, name, type, url] of lines) {
        if (i <= current_zoom) {
            continue;
        }
        let card = document.querySelector(`#cards [data-i='${i}']`);
        if (card === null) {
            continue;
        }
        if (card.style.display === "none") {
            continue;
        }
        zoom(i);
        return;
    }
}

window.addEventListener("load", async () => {
    await load();
    update();
    document.getElementById("decklist").addEventListener("change", switch_deck);
    document.getElementById("deck").addEventListener("input", update);
    document.getElementById("play").addEventListener("click", play);
    document.getElementById("download").addEventListener("click", download);
    document.getElementById("upload").addEventListener("click", upload);
    document.getElementById("upload_impl").addEventListener("change", upload_impl);
    document.getElementById("copy_link").addEventListener("click", copy_link);
    document.getElementById("clone").addEventListener("click", clone);
    document.getElementById("rename").addEventListener("click", rename);
    document.getElementById("delete").addEventListener("click", delete_deck);
    document.getElementById("toggle-unused").addEventListener("click", toggle_unused);
    document.getElementById("remove-unused").addEventListener("click", remove_unused);
    document.getElementById("zoom").addEventListener("click", () => {
        document.getElementById("zoom").style.display = "none";
    });
    document.getElementById("zoom-previous").addEventListener("click", zoom_previous);
    document.getElementById("zoom-next").addEventListener("click", zoom_next);
});
</script>
</head>
<body>

<div id="right">
<div class="inner">
<div class="column">

<div class="row big">
<select id="decklist">
</select>
</div>

<div class="row spaced">
<div>
<button id="play">Play</button>
</div>
<div>
<button id="download">Export</button>
<button id="upload">Import</button>
<input id="upload_impl" type="file" style="display: none" multiple />
</div>
<div>
<button id="copy_link">Copy link</button>
</div>
<div>
<button id="clone">Clone</button>
<button id="rename">Rename</button>
<button id="delete">Delete</button>
</div>
</div>

<textarea id="deck">
</textarea>

<div class="row spaced">
<div id="stats"></div>
<div>
<span id="stats-unused"></span>
<button id="toggle-unused">Hide</button>
<button id="remove-unused">Remove</button>
</div>
</div>

</div>
</div>
</div>

<div id="left">
<div class="inner">
<div id="cards">
</div>
</div>
</div>

<div id="zoom">
<div id="zoom-row" class="row spaced">
<div id="zoom-previous" class="row"><span class="zoom-cycle-text"><svg viewBox="0 0 24 24" fill="currentColor" stroke-width="0" stroke="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z"></path></svg></span></div>
<span class="card"><img><div class="quantity"><div class="minus"><div class="plus-minus-inner">–</div></div><div class="number">4</div><div class="plus"><div class="plus-minus-inner">+</div></div></div></span>
<div id="zoom-next" class="row"><span class="zoom-cycle-text"><svg viewBox="0 0 24 24" fill="currentColor" stroke-width="0" stroke="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"></path></svg></span></div>
</div>
</div>

</body>
</html>
